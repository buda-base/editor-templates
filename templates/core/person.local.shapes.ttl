# baseURI: http://purl.bdrc.io/shapes/core/PersonLocalShapes/
# imports: http://datashapes.org/dash
# imports: http://purl.bdrc.io/shapes/core/PersonEventShapes/
# prefix: PersonLocalShapes

@prefix PersonLocalShapes: <http://purl.bdrc.io/shapes/core/PersonLocalShapes/> .
@prefix adm: <http://purl.bdrc.io/ontology/admin/> .
@prefix bda: <http://purl.bdrc.io/admin.data/> .
@prefix bdg: <http://purl.bdrc.io/graph/> .
@prefix bdo: <http://purl.bdrc.io/ontology/core/> .
@prefix bdr: <http://purl.bdrc.io/resource/> .
@prefix bds: <http://purl.bdrc.io/ontology/shapes/core/> .
@prefix bdsa: <http://purl.bdrc.io/ontology/shapes/adm/> .
@prefix bf: <http://id.loc.gov/ontologies/bibframe/> .
@prefix cc: <http://creativecommons.org/ns#> .
@prefix dash: <http://datashapes.org/dash#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix iiif2: <http://iiif.io/api/presentation/2#> .
@prefix iiif3: <http://iiif.io/api/presentation/3#> .
@prefix lcsh: <http://id.loc.gov/authorities/subjects/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix swa: <http://topbraid.org/swa#> .
@prefix tbr: <http://purl.bdrc.io/ontology/toberemoved/> .
@prefix tosh: <http://topbraid.org/tosh#> .
@prefix vcard: <http://www.w3.org/2006/vcard/ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

bdo:Person 
  bds:localShapeGraph bdg:PersonLocalShapes ;
  bds:localShape bds:PersonLocalShape ;
.
PersonLocalShapes:
  a owl:Ontology ;
  owl:imports <http://datashapes.org/dash> ;
  owl:imports <http://purl.bdrc.io/shapes/core/PersonEventShapes/> ;
  owl:versionInfo "SHACL constraints for a internal elements of a Person graph" ;
.
bds:PersonLocalShape
  a sh:NodeShape ;
  adm:graphId bdg:PersonLocalShapes ;
  bds:identifierPrefix "P" ;
  bds:isLocalShape true ;
  rdfs:label "Person Shape"@en ;
  sh:property bds:PersonShape-personEvent ;
  sh:property bds:PersonShape-gender ;
  sh:property bds:PersonShape-personName ;
  sh:targetClass bdo:Person ;
.
bds:CheckPersonClassShape  a      sh:NodeShape ;
    rdfs:label      "Check Person Class Shape"@en ;
    sh:targetSubjectsOf bdo:isRoot ;
    sh:message "focusNode must be a bdo:Person" ;
    sh:sparql [
      a sh:SPARQLConstraint ;
      sh:prefixes [
        sh:declare [
          sh:prefix "rdf" ;
          sh:namespace "http://www.w3.org/1999/02/22-rdf-syntax-ns#" ;
        ] , [
          sh:prefix "bdo" ;
          sh:namespace "http://purl.bdrc.io/ontology/core/" ;
        ]
      ] ;
      sh:select """
        select distinct $this
        where {
             filter not exists { $this rdf:type bdo:Person }
        }	  
      """ ;
    ] ;
.
bds:FemaleShape
  a sh:NodeShape ;
  bds:nodeShapeType bds:IgnoreShape ;
  rdfs:label "Female Shape"@en ;
  sh:property bds:PersonShape-genderFemale ;
.
bds:MaleShape
  a sh:NodeShape ;
  bds:nodeShapeType bds:IgnoreShape ;
  rdfs:label "Male Shape"@en ;
  sh:property bds:PersonShape-genderMale ;
.
bds:PersonNameShape
  a sh:NodeShape ;
  bds:nodeShapeType bds:FacetShape ;
  rdfs:label "Person Name Shape"@en ;
  sh:property bds:PersonNameShape-personNameLabel ;
  sh:targetClass bdo:PersonName ;
.
bds:PersonNameShape-personNameLabel
  a sh:PropertyShape ;
  sh:path rdfs:label ;
  sh:datatype rdf:langString ;
  sh:description "this Person has a name given by the label."@en ;
  sh:maxCount 1 ;
  sh:minCount 1 ;
.
bds:PersonShape-personEvent
  a sh:PropertyShape ;
  sh:path bdo:personEvent ;
  sh:class bdo:PersonEvent ;
  sh:description "this Person may have zero or more events like birth, death, ordination."@en ;
  sh:minCount 0 ;
.
bds:PersonShape-gender
  a sh:PropertyShape ;
  sh:path bdo:personGender ;
  sh:class bdo:Gender ;
  sh:description "this Person may have at most one Gender or none if not known."@en ;
  sh:maxCount 1 ;
.
bds:PersonShape-genderFemale
  a sh:PropertyShape ;
  sh:path bdo:personGender ;
  sh:hasValue bdr:GenderFemale ;
  sh:maxCount 1 ;
  sh:minCount 1 ;
.
bds:PersonShape-genderMale
  a sh:PropertyShape ;
  sh:path bdo:personGender ;
  sh:hasValue bdr:GenderMale ;
  sh:maxCount 1 ;
  sh:minCount 1 ;
.
bds:PersonShape-personName
  a sh:PropertyShape ;
  sh:path bdo:personName ;
  sh:description "this Person may have one or more names."@en ;
  sh:message ":personName object must be a subClassOf* :PersonName" ;
  sh:minCount 1 ;
  sh:node bds:PersonNameShape ;
  sh:nodeKind sh:IRI ;
  sh:targetClass bdo:PersonName ;
.
